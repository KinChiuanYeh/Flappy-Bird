!function(a){function b(a){return a/180*Math.PI}function c(b){this.self=b,this.width=b.width,this.height=b.height,this.ctx=b.getContext("2d"),this.handleList=[],this.EventType=a.navigator.userAgent.indexOf("Mobile")>-1?"mousedown":"click"}function d(){this.imgSrcs=["birds","land","pipe1","pipe2","sky","cent","score_panel","text_game_over","button_play","title","tutorial","text_ready"],this.imgList={},this.hasLoadStaticSource=!1}c.prototype={constructor:c,addListner:function(a){var b=this;!a||b.handleList.indexOf(a)>-1||(b.handleList.push(a),b.self.addEventListener(b.EventType,a))},removeListner:function(a){var b=this;if(a){var c=this.handleList[a];b.self.removeEventListener(b.EventType,c),b.handleList.splice(a,1)}else b.handleList.forEach(function(a){b.self.removeEventListener(b.EventType,a)}),b.handleList.length=0}},d.prototype.load=function(a){var b=this.imgSrcs.length,c=0,d=this;return this.hasLoadStaticSource?void(a&&a.call(d)):void this.imgSrcs.forEach(function(e){var f=new Image;f.src="imgs/"+e+".png",d.imgList[e]=f,f.addEventListener("load",function(){c++,c==b&&(this.hasLoadStaticSource=!0,a&&a.call(d))})})};var e=null,f=null,g={toRadian:b,createCV:function(a){null==e&&(e=new c(a))},getCV:function(){return e},getStaticSource:function(){return null==f&&(f=new d),f}};a.Flappy=g}(window),function(a){var b={viewContainer:{width:window.innerWidth>800?800:window.innerWidth,height:window.innerHeight>667?667:window.innerHeight},bird:{position:{x:150,y:150},a:6e-4,flySpeedDelta:5,maxAngleSpeed:.5,flyUpMaxDropSpeed:.32},pipe:{speed:[1,2,3,4][2],pipeYSpace:150,pipeXSpaceDelta:3,paddingLeft:400},background:{speed:2},GODMODE:!1};a.Config=b}(Flappy),function(a){function b(b){this.ctx=a.getCV().ctx,this.x=b.x,this.y=b.y,this.buttonImg=b.buttonImg,this.imgW=this.buttonImg.width,this.imgH=this.buttonImg.height}b.prototype={constructor:b,draw:function(){this.ctx.drawImage(this.buttonImg,this.x,this.y,this.imgW,this.imgH)},addListener:function(b){var c=this,d=function(a){var d=c.x,e=c.y,f=a.offsetX,g=a.offsetY;f>=d&&f<=d+c.imgW&&g>=e&&g<=e+c.imgH&&b&&b()};a.getCV().addListner(d)}},a.Button=b}(Flappy),function(a){function b(b){this.ctx=a.getCV().ctx,this.titleImg=b.titleImg,this.titleX=b.titleX,this.titleY=b.titleY,this.titleW=this.titleImg.width,this.titleH=this.titleImg.height,this.helpImg=b.helpImg,this.helpX=b.helpX,this.helpY=b.helpY,this.helpW=this.helpImg.width,this.helpH=this.helpImg.height,this.getSkyBackgroud=a.Factory.createBackground("sky")}b.prototype={constructor:b,draw:function(b){var c=this,d=this.ctx;this.getSkyBackgroud[0].draw(),d.drawImage(c.titleImg,c.titleX,c.titleY,c.titleW,c.titleH),d.drawImage(c.helpImg,c.helpX,c.helpY,c.helpW,c.helpH);var e=a.getStaticSource().imgList.button_play,f=new a.Button({buttonImg:e,x:c.helpX+c.helpW/2-e.width/2,y:c.helpY+c.helpH+30});f.draw(),f.addListener(function(){b&&b()})}},a.StartView=b}(Flappy),function(a){function b(b){this.ctx=a.getCV().ctx,this.getCanvasWidth=a.getCV().width,this.readyImg=b.readyImg,this.readyX=b.readyX,this.readyY=b.readyY,this.readyW=this.readyImg.width,this.readyH=this.readyImg.height,this.needDestroy=!1,this.startTime=0}b.prototype={constructor:b,draw:function(){var a=this,b=this.ctx,c=this.startTime;this.needDestroy||(c<=100?b.drawImage(a.readyImg,a.readyX,a.readyY,a.readyW,a.readyH):(this.needDestroy=!0,this.startTime=0),this.startTime++)}},a.ReadyView=b}(Flappy),function(a){function b(b,c,d,e,f){var g=a.Config.background;this.ctx=b,this.img=c,this.imgW=c.width,this.x0=d,this.y0=e,this.count=f,this.speed=g.speed,this.canMove=!1}b.prototype={constructor:b,draw:function(){this.canMove&&(this.x0-=this.speed,this.x0<=-this.imgW&&(this.x0+=this.imgW*this.count)),this.ctx.drawImage(this.img,this.x0,this.y0)}},a.Background=b}(Flappy),function(a){function b(b){var c=a.Config.pipe;this.ctx=b.ctx,this.pipeXSpaceDelta=c.pipeXSpaceDelta,this.paddingLeft=c.paddingLeft,this.x=b.x*this.pipeXSpaceDelta+this.paddingLeft,this.imgUp=b.imgUp,this.imgDown=b.imgDown,this.imgW=this.imgUp.width,this.imgH=this.imgUp.height,this.speed=c.speed,this.pipeYSpace=c.pipeYSpace,this.upY=0,this.downY=0,this.canMove=!1,this.getBirdXPosition=a.Config.bird.position.x,this._initPipeY()}b.prototype={constructor:b,hasPassed:function(){return this.x+this.paddingLeft%this.speed+(4==this.speed?2:0)==this.getBirdXPosition-this.imgW},draw:function(){var a=this.ctx;this.canMove&&(this.x-=this.speed,this.x<-this.imgW&&(this.x+=3*this.imgW*6,this._initPipeY())),a.drawImage(this.imgUp,this.x,this.upY),a.drawImage(this.imgDown,this.x,this.downY),this._initPath(a)},_initPipeY:function(){var a=Math.floor(200*Math.random())+50;this.upY=a-this.imgH,this.downY=a+this.pipeYSpace},_initPath:function(a){a.rect(this.x,this.upY,this.imgW,this.imgH),a.rect(this.x,this.downY,this.imgW,this.imgH)}},a.Pipe=b}(Flappy),function(a){function b(b){var c=a.Config.bird;this.ctx=b.ctx,this.x0=c.position.x,this.y0=c.position.y,this.birdImg=b.birdImg,this.imgW=this.birdImg.width/3,this.imgH=this.birdImg.height,this.frameIndex=0,this.a=c.a,this.flyUpMaxDropSpeed=c.flyUpMaxDropSpeed,this.flySpeed=0,this.flySpeedDelta=c.flySpeedDelta,this.dropSpeed=0,this.maxAngleSpeed=c.maxAngleSpeed,this.curTime=0,this.lastTime=new Date,this.canMove=!1,this._getCanvasHeight=b.canvasHeight,this._getLandHieght=b.landHieght}b.prototype={constructor:b,refresh:function(){this.frameIndex=0,this.flySpeed=0,this.dropSpeed=0,this.curTime=0,this.lastTime=new Date},fly:function(){this.canMove&&(this.dropSpeed=-this.flyUpMaxDropSpeed)},isGoDie:function(){var b=this.ctx,c=!1,d=this._getCanvasHeight-this._getLandHieght-10,e=.5*this.imgW-10,f=.5*this.imgH-10;return(this.y0<0||this.y0>=d||b.isPointInPath(this.x0+e,this.y0+f)||b.isPointInPath(this.x0-e,this.y0-f))&&(c=!0),a.Config.GODMODE&&(c=!1),c},draw:function(){var a=this.ctx;this.curTime=new Date;var b=this.imgW,c=this.imgH,d=this.curTime-this.lastTime;this.lastTime=this.curTime,a.save(),this._rotate(a),a.drawImage(this.birdImg,this.frameIndex*b,0,b,c,-.5*b,-.5*c,b,c),a.restore(),this._nextFPS(),this.canMove&&this._dropSpeedChange(d)},_rotate:function(b){var c=this.maxAngleSpeed,d=0;this.dropSpeed>=c?d=45:this.dropSpeed<=-c&&(d=-45),d=this.dropSpeed/c*45,b.translate(this.x0,this.y0),b.rotate(a.toRadian(d))},_nextFPS:function(){this.flySpeed++,this.flySpeed%this.flySpeedDelta==0&&(this.frameIndex++,this.frameIndex%=3)},_dropSpeedChange:function(a){var b=this.a;this.dropSpeed+=b*a,this.y0+=this.dropSpeed*a+.5*b*a*a}},a.Bird=b}(Flappy),function(a,b){function c(c,d){this.cent=0,this.y=d,this.centImg=c,this.imgW=this.centImg.width/10,this.imgH=this.centImg.height,this.ctx=a.getCV().ctx,this.getCanvasWidth=a.getCV().width,this.maxCent=b.localStorage.getItem("flappy_max_cent")||0}c.prototype={constructror:c,set:function(a){this.cent=a},get:function(){return this.cent},draw:function(a,b,c){var d=this.ctx,a=a||this.get(),e=0,c=c||this.y,f=0,g=0,h=this.imgW,i=this.imgH,j=(a+"").split(""),k=j.length;if(f=this.getCanvasWidth/2-h*k/2,b)d.fillStyle="#543847",d.font="26px consolas",d.fillText(a,f+b,c+12);else for(var l=0;l<j.length;l++)g=j[l],e=l+1<=k/2?f-(k/2-l)*h:k%2==0&&l+1==Math.ceil(k/2)?f-.5*h:f+(l-k/2)*h,e+=h*k/2,d.drawImage(this.centImg,g*h,0,h,i,e,c,h,i)}},a.Cent=c}(Flappy,window),function(a){function b(b){this.ctx=a.getCV().ctx,this.getCanvasWidth=a.getCV().width,this.overImg=b.overImg,this.overX=b.overX,this.overY=b.overY,this.overW=this.overImg.width,this.overH=this.overImg.height,this.scorePanelImg=b.scorePanelImg,this.scoreX=b.scoreX,this.scoreY=b.scoreY,this.scoreW=this.scorePanelImg.width,this.scoreH=this.scorePanelImg.height,this.getCent=b.getCent}b.prototype={constructor:b,draw:function(b){var c=this.ctx,d=this;c.drawImage(d.overImg,d.overX,d.overY,d.overW,d.overH),c.drawImage(d.scorePanelImg,d.scoreX,d.scoreY,d.scoreW,d.scoreH);var e=this.getCent.get(),f=this.getCent.maxCent;this.getCent.draw(e,95,d.scoreY+40),this.getCent.draw(f,95,d.scoreY+82);var g=a.getStaticSource().imgList.button_play,h=new a.Button({buttonImg:g,x:d.scoreX+d.scoreW/2-g.width/2,y:d.scoreY+d.scoreH+30});h.draw(),h.addListener(function(){b&&b()})}},a.OverView=b}(Flappy),function(a){var b={createBird:function(){var b=a.getCV(),c=a.getStaticSource().imgList,d=new a.Bird({ctx:b.ctx,birdImg:c.birds,landHieght:c.land.height,canvasHeight:b.height});return d},createBackground:function(b){var c=a.getCV().ctx,d=a.getStaticSource().imgList,e=a.getCV().self,f=null,g=null,h=0,i=0,j=0,k=[],l=0;"sky"==b?(g=d.sky,l=2,j=0):"land"==b&&(g=d.land,l=4,j=e.height-g.height),h=g.width;for(var m=0;m<l;m++)i=m*h,f=new a.Background(c,g,i,j,l),k.push(f);return k},createPipes:function(){for(var b=a.getCV().ctx,c=a.getStaticSource().imgList,d=c.pipe2,e=c.pipe1,f=[],h=(a.Config.pipe,0);h<6;h++){var i=new a.Pipe({ctx:b,imgUp:d,imgDown:e,x:h*d.width});f.push(i)}return f},createCent:function(){return new a.Cent(a.getStaticSource().imgList.cent,70)},createStartView:function(){var b=a.getCV().width,c=a.getStaticSource().imgList,d=c.title,e=c.tutorial;return new a.StartView({titleImg:d,titleX:b/2-d.width/2,titleY:50,helpImg:e,helpX:b/2-e.width/2,helpY:150})},createReadyView:function(){var b=a.getCV().width,c=a.getStaticSource().imgList,e=(c.cent,c.text_ready);return new a.ReadyView({readyImg:e,readyX:b/2-e.width/2,readyY:150})},createOverView:function(b){var c=a.getCV().width,d=a.getStaticSource().imgList,e=d.text_game_over,f=d.score_panel;return new a.OverView({getCent:b,overImg:e,overX:c/2-e.width/2,overY:50,scorePanelImg:f,scoreX:c/2-f.width/2,scoreY:130})}};a.Factory=b}(Flappy),function(a,b){function c(a){this.canvas=a,this.roleList=[],this.control={},this.hasLoadStaticSource=!1,this.animateFrame=null,this.isFirstStart=!0,this.hasReady=!1,this.isOver=!1}function d(){var b=this;b.canvas.width=a.Config.viewContainer.width,b.canvas.height=a.Config.viewContainer.height,a.createCV(b.canvas),a.getStaticSource().load(function(){var c=a.Factory;if(b.isFirstStart){var d=c.createStartView(),e=function(){a.getCV().removeListner(),b.start()};return d.draw(e),void(b.isFirstStart=!1)}var f=c.createBackground("sky");b.roleList=b.roleList.concat(f);var g=c.createPipes();b.roleList=b.roleList.concat(g),b.control.getPipes=g;var h=c.createBackground("land");b.roleList=b.roleList.concat(h);var i=c.createBird();b.roleList.push(i),b.control.getBird=i;var j=c.createCent();b.roleList.push(j),b.control.getCent=j;var k=c.createReadyView();b.roleList.push(k),b.control.getReadyView=k;var l=c.createOverView(j);b.control.getOverView=l,b._render(),b._addListener()})}function e(){var b=this;a.getCV().addListner(function(){b.control.getBird.fly()})}function f(){this._init()}function g(){var b=this;b.hasReady=!1,b.isOver=!1,a.getCV().removeListner(),b.control.getBird.refresh(),b.roleList=[],b.control={},b.animateFrame=null,b._init()}function h(b){(b instanceof a.Background||b instanceof a.Pipe||b instanceof a.Bird)&&(b.canMove=!0)}function i(){var c=this,d=b.localStorage,e=d.getItem("flappy_max_cent"),f=c.control.getCent.get();e<f&&(d.setItem("flappy_max_cent",f),c.control.getCent.maxCent=f),setTimeout(function(){c.roleList.forEach(function(b){b instanceof a.Background&&b.draw()});var b=function(){c._reStart()};c.control.getOverView.draw(b)},300)}function j(){var c=this,d=a.getCV().ctx,e=this.width,f=this.height;!function g(){d.beginPath(),d.clearRect(0,0,e,f);var h=c.roleList;h.forEach(function(b){b.needDestroy?(h.splice(h.indexOf(b,1)),b instanceof a.ReadyView&&(c.hasReady=!0)):b.draw(),c.hasReady&&c._play(b)}),c.isOver=c.control.getBird.isGoDie(c),c._centChange(),c.isOver?c.over():c.animateFrame=b.requestAnimationFrame(g)}()}function k(){var a=this;a.control.getPipes.forEach(function(b){if(b.hasPassed()){var c=a.control.getCent;c.set(c.get()+1)}})}function l(a){for(var b in a)"constructor"!=b&&(c.prototype[b]=a[b])}c.prototype={constructor:c,_init:d,start:f,_play:h,_reStart:g,over:i,_render:j,_centChange:k,_addListener:e,extend:l};var m=null;a.Game={getInstance:function(a){return m?m:new c(a)}}}(Flappy,window);